{% if error %}
<div class="p-6 bg-red-500/10 border border-red-500/30 rounded-lg text-center">
    <h3 class="text-red-400 font-bold text-lg mb-2">⚠️ Ops! Algo deu errado.</h3>
    <p class="text-gray-400">{{ error }}</p>
    {% if agencies %}
    <div class="mt-4 pt-4 border-t border-red-500/20">
        <p class="text-sm text-gray-500 mb-2">Tente contatar diretamente as agências identificadas:</p>
        <div class="flex flex-wrap justify-center gap-2">
            {% for agency in agencies %}
            <a href="https://{{ agency.site }}" target="_blank"
                class="px-3 py-1 bg-dark-700 rounded-full text-xs text-primary hover:bg-dark-600 transition">
                {{ agency.name }}
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% else %}

<!-- Analytics Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-dark-800 p-6 rounded-lg border-l-4 border-blue-500">
        <p class="text-gray-400 text-sm uppercase">Imóveis Analisados</p>
        <p class="text-3xl font-bold text-white">{{ stats.count }}</p>
    </div>
    <div class="bg-dark-800 p-6 rounded-lg border-l-4 border-purple-500">
        <p class="text-gray-400 text-sm uppercase">Média da Região</p>
        <p class="text-3xl font-bold text-white">R$ {{ "%.2f"|format(stats.avg_m2) }}/m²</p>
    </div>
    <div class="bg-dark-800 p-6 rounded-lg border-l-4 border-primary">
        <p class="text-gray-400 text-sm uppercase">Melhor Oportunidade</p>
        {% if stats.best_deal %}
        <p class="text-3xl font-bold text-primary">{{ stats.best_deal['Dif vs Med (%)'] }}%</p>
        <p class="text-xs text-gray-400">Abaixo da média</p>
        {% else %}
        <p class="text-xl text-gray-500">-</p>
        {% endif %}
    </div>
</div>

<!-- Results Table -->
<div class="bg-dark-800 rounded-lg overflow-hidden border border-gray-700">
    <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
            <thead class="bg-dark-700 text-gray-400 uppercase text-xs font-bold">
                <tr>
                    <th class="px-6 py-4">Bairro</th>
                    <th class="px-6 py-4">Tipo</th>
                    <th class="px-6 py-4">Área</th>
                    <th class="px-6 py-4">Valor Total</th>
                    <th class="px-6 py-4">R$/m²</th>
                    <th class="px-6 py-4 text-center">Desconto</th>
                    <th class="px-6 py-4 text-right">Ação</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
                {% for item in results %}
                <tr class="hover:bg-dark-700 transition-colors group">
                    <td class="px-6 py-4 font-medium text-white">{{ item.Bairro }}</td>
                    <td class="px-6 py-4 text-gray-300">{{ item.Tipo }}</td>
                    <td class="px-6 py-4 text-gray-300">{{ item['Área (m²)'] }} m²</td>
                    <td class="px-6 py-4 text-white font-semibold">R$ {{ "%.2f"|format(item['Valor Total']) }}</td>
                    <td class="px-6 py-4 text-gray-400">R$ {{ "%.2f"|format(item['Valor/m²']) }}</td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-block px-2 py-1 rounded text-xs font-bold
                            {% if item['Dif vs Med (%)'] < -20 %}bg-primary/20 text-primary
                            {% elif item['Dif vs Med (%)'] < 0 %}bg-blue-500/20 text-blue-400
                            {% else %}bg-red-500/20 text-red-400{% endif %}">
                            {{ item['Dif vs Med (%)'] }}%
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <a href="{{ item.Link }}" target="_blank"
                            class="inline-flex items-center gap-1 text-primary hover:text-white transition-colors text-xs uppercase font-bold tracking-wider">
                            Ver Anúncio ↗
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if agencies %}
<div class="mt-8">
    <h4 class="text-sm font-bold text-gray-500 uppercase mb-3">Imobiliárias Identificadas na Região</h4>
    <div class="flex flex-wrap gap-2">
        {% for agency in agencies %}
        <a href="https://{{ agency.site }}" target="_blank"
            class="px-3 py-1 bg-dark-700 border border-gray-600 rounded-full text-xs text-primary hover:bg-dark-600 transition">
            {{ agency.name }}
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endif %}